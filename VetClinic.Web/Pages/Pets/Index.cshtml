@page
@model VetClinic.Web.Pages.Pets.IndexModel
@{
    ViewData["Title"] = "Pets";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="bi bi-heart-fill text-danger me-2"></i>Pets</h1>
        <a asp-page="Create" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i>Add New Pet
        </a>
    </div>

    <!-- Search and Filter -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Search</label>
                    <input type="text" name="searchTerm" value="@Model.SearchTerm" class="form-control" placeholder="Search by name, breed, or owner...">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Species</label>
                    <select name="species" class="form-select">
                        <option value="">All Species</option>
                        <option value="Dog" selected="@(Model.Species == "Dog")">Dog</option>
                        <option value="Cat" selected="@(Model.Species == "Cat")">Cat</option>
                        <option value="Bird" selected="@(Model.Species == "Bird")">Bird</option>
                        <option value="Rabbit" selected="@(Model.Species == "Rabbit")">Rabbit</option>
                        <option value="Other" selected="@(Model.Species == "Other")">Other</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Status</label>
                    <select name="isAdopted" class="form-select">
                        <option value="">All</option>
                        <option value="false" selected="@(Model.IsAdopted == false)">Available for Adoption</option>
                        <option value="true" selected="@(Model.IsAdopted == true)">Adopted</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-outline-primary w-100">
                        <i class="bi bi-search me-1"></i>Filter
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h5 class="card-title">Total Pets</h5>
                    <h2>@Model.TotalPets</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5 class="card-title">Adopted</h5>
                    <h2>@Model.AdoptedPets</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark">
                <div class="card-body">
                    <h5 class="card-title">Available</h5>
                    <h2>@Model.AvailablePets</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5 class="card-title">Species</h5>
                    <h2>@Model.UniqueSpecies</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Pet Cards -->
    @if (!Model.Pets.Any())
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>No pets found. <a asp-page="Create">Add the first pet!</a>
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4">
            @foreach (var pet in Model.Pets)
            {
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span class="badge @(pet.Species == "Dog" ? "bg-primary" : pet.Species == "Cat" ? "bg-success" : "bg-secondary")">
                                @pet.Species
                            </span>
                            @if (pet.IsAdopted)
                            {
                                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Adopted</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark"><i class="bi bi-heart me-1"></i>Available</span>
                            }
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">@pet.Name</h5>
                            <p class="card-text text-muted mb-2">@pet.Breed</p>
                            <ul class="list-unstyled small">
                                <li><i class="bi bi-calendar me-2"></i>Age: @CalculateAge(pet.DateOfBirth)</li>
                                <li><i class="bi bi-palette me-2"></i>Color: @(pet.Color ?? "N/A")</li>
                                <li><i class="bi bi-speedometer me-2"></i>Weight: @pet.Weight kg</li>
                                @if (pet.Owner != null)
                                {
                                    <li><i class="bi bi-person me-2"></i>Owner: @pet.Owner.FullName</li>
                                }
                            </ul>
                        </div>
                        <div class="card-footer bg-transparent">
                            <div class="btn-group w-100" role="group">
                                <a asp-page="Details" asp-route-id="@pet.Id" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-eye"></i> View
                                </a>
                                <a asp-page="Edit" asp-route-id="@pet.Id" class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-pencil"></i> Edit
                                </a>
                                @if (!pet.IsAdopted)
                                {
                                    <a asp-page="Adopt" asp-route-id="@pet.Id" class="btn btn-outline-success btn-sm">
                                        <i class="bi bi-heart-fill"></i> Adopt
                                    </a>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@functions {
    string CalculateAge(DateTime birthDate)
    {
        var today = DateTime.Today;
        var age = today.Year - birthDate.Year;
        if (birthDate.Date > today.AddYears(-age)) age--;
        
        if (age < 1)
        {
            var months = (today.Year - birthDate.Year) * 12 + today.Month - birthDate.Month;
            return $"{months} months";
        }
        return $"{age} years";
    }
}